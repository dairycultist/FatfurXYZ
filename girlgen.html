<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>app</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap');
        
        body { font-family: "Inter", sans-serif; display: flex; gap: 1em; }
    </style>
    <script>

        async function promptText(key, prompt) {

            prompt = prompt.replaceAll("\"", "'");
            
            // https://openrouter.ai/deepseek/deepseek-chat:free/api
            
            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + key
                },
                body: `{
                        "model": "deepseek/deepseek-chat:free",
                        "messages": [
                            {
                            "role": "user",
                            "content": "${prompt}"
                            }
                        ]
                    }`
            });

            if (!response.ok) {
                console.log(await response.json());
                return "<span style='color: red;'>Network error. See console for details.</span>";
            }
            
            return (await response.json()).choices[0].message.content;
        }
        
        async function generate() {

            const generateButton = document.getElementById("generateButton");
            const key = document.getElementById("key").value;

            generateButton.disabled = true;

            var bio = await promptText(key,
                "I am going to give you vague details about a character. Please build on them to provide a full, detailed character background (personality, species, setting, etc). Keep it brief but detailed and unique: "
                + document.getElementById("characterDetails").value
            );

            console.log(bio);

            var imageGenPrompt = await promptText(key,
                "I am going to give you a full biography about a character. Please give me a short list of words that describe the character's appearance (their species, height, weight, clothing, emotion, environment, etc) separated by commas. Only include details that are visual: "
                + bio
            );

            {
                bio = bio.replaceAll("\n", "<br>");
    
                while (bio.match(/\*\*([^*]+)\*\*/)) {
                    bio = bio.replace(/\*\*([^*]+)\*\*/, "<strong>$1<\/strong>");
                }

                while (bio.match(/\*(.+)\*/)) {
                    bio = bio.replace(/\*(.+)\*/, "<i>$1<\/i>");
                }

                document.getElementById("bioOutput").innerHTML = "<h2>Character bio</h2>" + bio;
                document.getElementById("imageOutput").innerHTML = "<h2>Image generation prompt</h2>" + imageGenPrompt.replaceAll("*", "");
            }

            generateButton.disabled = false;
        }
    </script>
</head>

<body>
    
    <div style="flex: 1;">
        <a href="https://github.com/dairycultist/FatfurXYZ/blob/main/girlgen.html">see code</a>
        <p>
            <label for="fname"><a href="https://openrouter.ai/">OpenRouter</a> Key:</label>
            <input type="text" id="key">
        </p>
        <textarea id="characterDetails" style="width: 100%; height: 10em;" placeholder="Describe your character..."></textarea>
        <br>
        <button type="button" id="generateButton" onclick="generate();">Generate</button>
    </div>

    <div id="bioOutput" style="background: #eee; border: 1px solid black; padding: 1em; flex: 1;"></div>

    <div id="imageOutput" style="flex: 1; font-family: monospace;"></div>
    
</body>

</html>
